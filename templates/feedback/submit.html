{% extends "base.html" %}

{% block title %}Send Feedback - BankU{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h4 class="card-title mb-0">
                        <i class="fas fa-comment-dots me-2"></i>Send Feedback
                    </h4>
                    <p class="text-muted mb-0">Help us improve BankU by sharing your thoughts</p>
                </div>
                <div class="card-body p-4">
                    <form id="feedbackForm" method="POST" action="{{ url_for('feedback.submit_feedback') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <div class="mb-4">
                            <label for="type" class="form-label">Feedback Type *</label>
                            <select class="form-select" id="type" name="type" required>
                                <option value="">Select feedback type...</option>
                                <option value="suggestion">üí° Suggestion</option>
                                <option value="problem">üêõ Problem Report</option>
                                <option value="request_deals">ü§ù Request Make Deals on App</option>
                                <option value="request_call">üìû Request Call from Customer Service</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label for="subject" class="form-label">Subject *</label>
                            <input type="text" class="form-control" id="subject" name="subject" 
                                   placeholder="Brief description of your feedback" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="message" class="form-label">Message *</label>
                            <textarea class="form-control" id="message" name="message" rows="6" 
                                      placeholder="Please provide detailed information about your feedback..." required></textarea>
                        </div>
                        
                        <div class="mb-4">
                            <label for="priority" class="form-label">Priority</label>
                            <select class="form-select" id="priority" name="priority">
                                <option value="low">üü¢ Low - General feedback</option>
                                <option value="medium" selected>üü° Medium - Important but not urgent</option>
                                <option value="high">üü† High - Important and urgent</option>
                                <option value="urgent">üî¥ Urgent - Critical issue</option>
                            </select>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('dashboard.index') }}" class="btn btn-outline-secondary me-md-2">
                                <i class="fas fa-arrow-left me-1"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-1"></i>Send Feedback
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('feedbackForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Sending...';
    submitBtn.disabled = true;
    
    fetch(this.action, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>${data.message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // Insert before the form
            this.parentNode.insertBefore(alertDiv, this);
            
            // Reset form
            this.reset();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
            // Show error message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-exclamation-circle me-2"></i>${data.message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            // Insert before the form
            this.parentNode.insertBefore(alertDiv, this);
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    })
    .catch(error => {
        console.error('Error:', error);
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger alert-dismissible fade show';
        alertDiv.innerHTML = `
            <i class="fas fa-exclamation-circle me-2"></i>An error occurred while sending your feedback. Please try again.
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        // Insert before the form
        this.parentNode.insertBefore(alertDiv, this);
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
    })
    .finally(() => {
        // Reset button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    });
});
</script>
{% endblock %}
